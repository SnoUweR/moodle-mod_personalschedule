define(["jquery","core/str","core/modal_factory","core/notification"],function(a,b,c,d){function e(){for(var a=new FormData(document.querySelector("#personalscheduleform")),b=a.entries(),c={},d=!0;d;){var e=b.next();if(e.done){d=!1;break}var f=e.value[0].split(h);if(3===f.length&&f[1]!==i){var g=f[1],j=f[2];j in c||(c[j]={}),c[j][g]=e.value[1]}}return c}function f(a,b){return!(!a.hasClass("schedule-readiness")||!b.hasClass("schedule-readiness"))||!(!a.hasClass("schedule-status")||!b.hasClass("schedule-status"))}var g=Object.freeze({sleep:"-1",busy:"0",free:"1"}),h=";",i="-2",j=5,k=105,l=[{key:"validation_schedulesetting",component:"personalschedule"},{key:"validation_readinesssetting",component:"personalschedule"},{key:"validation_sleep",component:"personalschedule"},{key:"validation_busy",component:"personalschedule"},{key:"validation_free",component:"personalschedule"}],m="",n="",o="",p="",q="";return b.get_strings(l).then(function(a){return m=a[0],n=a[1],o=a[2],p=a[3],q=a[4],!0}),{addHandlersToForm:function(){var f=b.get_strings([{key:"error",component:"moodle"},{key:"ageisnotvalid",component:"personalschedule"}]).then(function(a){return c.create({type:c.types.CANCEL,title:a[0],body:a[1]})})["catch"](d.exception),h=b.get_strings([{key:"error",component:"moodle"},{key:"nofreeperiods",component:"personalschedule"}]).then(function(a){return c.create({type:c.types.CANCEL,title:a[0],body:a[1]})})["catch"](d.exception),i=a("#personalscheduleform");i.submit(function(b){var c=a("#age-input"),d=c.val();if(d<j||d>k)return b.preventDefault(),f.then(function(a){return a.show(),!1});var i=0,l=e();for(var m in l)if(l.hasOwnProperty(m))for(var n in l[m])if(l[m].hasOwnProperty(n)){var o=l[m][n];o===g.free&&i++}return 0!==i||(b.preventDefault(),h.then(function(a){return a.show(),!1}))})},addFunctionalToTable:function(){function b(a,b){b===g.sleep?(a.addClass("schedule-sleep"),a.removeClass("schedule-busy"),a.removeClass("schedule-free")):b===g.busy?(a.removeClass("schedule-sleep"),a.addClass("schedule-busy"),a.removeClass("schedule-free")):b===g.free?(a.removeClass("schedule-sleep"),a.removeClass("schedule-busy"),a.addClass("schedule-free")):(a.removeClass("schedule-sleep"),a.removeClass("schedule-busy"),a.removeClass("schedule-free"))}function c(a,b){return a===b?"checked":""}function d(){for(var b=parseFloat(a("#total-course-duration-hours-value").val()),c=1,d=e(),f=!1;b>0;){for(var h in d)if(d.hasOwnProperty(h)){for(var i in d[h])if(d[h].hasOwnProperty(i)){var j=d[h][i];j===g.free&&(b--,f=!0)}if(b<=0)break;c++}if(!f)break}f?a("#scheduled-course-duration-days").text(c):a("#scheduled-course-duration-days").text("-")}var h=a("th").length-1;a.fn.select=function(){var b=a.extend({children:"tbody tr",className:"personal-table-selected"},arguments[0]||{});return this.each(function(c,d){var e,g=a(this).find(b.children),i=[];g.on("mousedown",function(c){var j=c.ctrlKey||c.metaKey,k=c.shiftKey,l=g.index(this),m=g.index(e),n=a.inArray(this,i);if((k||j)&&c.preventDefault(),a(i).removeClass(b.className),a(i).popover("destroy"),i.length>0&&!f(a(this),a(i[i.length-1]))&&(j=!1,k=!1,i=[]),j)n>-1?i.splice(n,1):i.push(this);else if(k&&i.length>0){l>m&&(l=[m,m=l][0]);var o=l,p=m;o>p&&(o=m,p=l);for(var q=o%h,r=Math.floor(o/h),s=p%h,t=Math.floor(p/h),u=q;u<=s;u++)for(var v=r;v<=t;v++){var w=v*h+u;i.push(g[w])}}else i=n<0||i.length>1?[this]:[];e=this,a(i).addClass(b.className),b.onSelect.call(d,i)})})};var i,j,k,l=a("#scheduling-table");l.select({children:"td.schedule-selectable",className:"personal-table-selected",onSelect:function(b){b.length>0&&(i=a(b),j=i.find("span"),k=i.last(),k.hasClass("schedule-readiness")?k.popover({container:"#scheduling-table",html:!0,trigger:"manual",placement:"bottom",content:'    <input class="personal-table-schedule-input" type="number" step="0.05" min="0" max="1" name="options" id="schedule-input-sleep" autocomplete="off" value="'+j.text()+'"/>',title:n}):k.popover({container:"#scheduling-table",html:!0,trigger:"manual",placement:"bottom",content:'<div class="btn-group btn-group-toggle personal-table-btn-group" data-toggle="buttons">\n  <label class="personal-table-btn-group-label btn btn-secondary">\n    <input class="personal-table-schedule-input" type="radio" name="options" id="schedule-input-sleep" autocomplete="off" '+c(j.text(),g.sleep)+"> "+o+'\n  </label>\n  <label class="btn btn-secondary personal-table-btn-group-label">\n    <input class="personal-table-schedule-input" type="radio" name="options" id="schedule-input-busy" autocomplete="off" '+c(j.text(),g.busy)+"> "+p+'\n  </label>\n  <label class="btn btn-secondary personal-table-btn-group-label">\n    <input class="personal-table-schedule-input" type="radio" name="options" id="schedule-input-free" autocomplete="off" '+c(j.text(),g.free)+"> "+q+"\n  </label>\n</div>",title:m}),k.popover("show"))}}),l.on("change",".personal-table-schedule-input",function(){var c=i.find("input");if(k.hasClass("schedule-readiness")){var e=a("#scheduling-table .personal-table-schedule-input").val();j.text(e),c.val(e)}else{var f=a("#scheduling-table .personal-table-schedule-input:checked").attr("id");"schedule-input-sleep"===f?(b(i,g.sleep),j.text(g.sleep),c.val(g.sleep)):"schedule-input-busy"===f?(b(i,g.busy),j.text(g.busy),c.val(g.busy)):"schedule-input-free"===f&&(b(i,g.free),j.text(g.free),c.val(g.free))}d()})}}});